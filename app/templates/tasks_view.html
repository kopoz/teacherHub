{% extends 'layout.html' %}

{% block content %}

<!-- Include stylesheet -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
.select2-container .select2-selection--multiple {
    min-height: 36px;  /* Adjust as needed */
    overflow-y: auto;  /* Add a vertical scrollbar when the tags exceed the height */
}
.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: #007bff;  /* Adjust the background color as needed */
    border-color: #006fe6;  /* Adjust the border color as needed */
    color: #fff;  /* Adjust the text color as needed */
    padding: 5px;  /* Adjust the padding as needed */
}
</style>

<h1>Tasks</h1>

<div id="alert-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
  <!-- Alerts will be added here -->
</div>
<!-- Task Form Card -->
<div class="card">
  <div class="card-header" id="taskFormHeading">
    <h5 class="mb-0">
      <button class="btn btn-link" type="button" data-bs-toggle="collapse" href="#task-form-container"
        aria-expanded="true" aria-controls="task-form-container">Toggle Task Form
      </button>
    </h5>
  </div>

  <div id="task-form-container" class="collapse" aria-labelledby="taskFormHeading">
    <div class="card-body">
      <form id="task-form" data-action-url="{{ url_for('task_api_bp.create_task') }}" method="post"
        enctype="multipart/form-data">
        <div class="form-group">
          <label for="name">Task Name</label>
          <input type="text" class="form-control" id="name" name="name" placeholder="Task Name" required>
        </div>
        <div class="form-group">
          <label for="quill-editor">Task Content</label>
          <div id="quill-editor"></div>
          <input type="hidden" name="content" id="content">
        </div>
        <div class="form-group">
          <label for="targeted_school_year">Targeted School Year</label>
          <input type="number" class="form-control" id="targeted_school_year" name="targeted_school_year"
            placeholder="Targeted School Year" required>
        </div>
        <div class="form-group">
          <label for="time_estimation">Time Estimation</label>
          <input type="number" class="form-control" id="time_estimation" name="time_estimation"
            placeholder="Time Estimation" required>
        </div>
        <div class="form-group">
          <label for="tags">Tags</label>
          <select class="form-control" id="tags" name="tags[]" data-url="{{ url_for('task_api_bp.get_tags') }}"
            multiple></select>
        </div>

        <div class="form-group">
          <label for="additional_files">Additional Files</label>
          <input type="file" class="form-control-file" id="additional_files" name="additional_files[]" multiple>
        </div>
        <button type="submit" class="btn btn-primary">Create Task</button>
      </form>
    </div>
  </div>
</div>

<!-- List of Tasks -->
<table class="table table-striped mt-4">
  <thead>
    <tr>
      <th>Name</th>
      <th>Content</th>
      <th>Targeted School Year</th>
      <th>Time Estimation</th>
      <th>Tags</th>
      <th>Additional Files</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
      <td>{{ task.name }}</td>
      <td>
        <button class="toggle-button">Toggle display</button>
        <div class="display-div" style="display: none;">{{ task.content|safe }}</div>
      </td>
      <td>{{ task.targeted_school_year }}</td>
      <td>{{ task.time_estimation }}</td>
      <td>{{ task.tags | map(attribute='name') | join(', ') }}</td>
      <td>
        {% for file in task.additional_files %}
        <a href="{{ url_for('task_api_bp.get_file', filename=file) }}">{{ file }}</a><br>
        {% endfor %}
      </td>
      <td>
        <a href="{{ url_for('task_api_bp.update_task', id=task.id) }}" class="btn btn-warning btn-sm">Edit</a>
        <a href="#" class="btn btn-danger btn-sm delete-resource"
          data-url="{{ url_for('task_api_bp.delete_task', id=task.id) }}">Delete</a>
      </td>
    </tr>
    {% endfor %}

  </tbody>
</table>
<script src="{{ url_for('static', filename='crud.js') }}"></script>


{% endblock %}